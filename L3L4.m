%L3 L4
 IC04 = [0.28, 0.02;
0.10, 0.57;
-0.15, 1.08;
-0.08, 1.60;
-0.31, 2.11;
-0.24, 2.62;
-0.18, 3.13;
-0.14, 3.64;
-0.11, 4.16;
-0.08, 4.67;
-0.06, 5.18;
-0.05, 5.70;
-0.04, 6.22;
-0.02, 6.73;
-0.02, 7.24;
-0.61, 7.77;
-0.31, 8.27;
-0.07, 8.78;
0.13, 9.29;
0.02, 9.80;
0.33, 10.31;
0.25, 10.82;
0.19, 11.33;
0.15, 11.85;
0.11, 12.36;
0.09, 12.88;
0.06, 13.38;
0.05, 13.90;
0.04, 14.41;
0.03, 14.93;
0.02, 15.44;
1.05, 15.96;
0.49, 16.46;
0.16, 16.97;
-0.07, 17.48;
-0.14, 18.00;
-0.18, 18.51;
-0.27, 19.03;
-0.20, 19.54;
-0.16, 20.06;
-0.12, 20.56;
-0.10, 21.07;
-0.07, 21.58;
-0.05, 22.10;
-0.04, 22.61;
-0.03, 23.12;
-0.03, 23.64;
-1.26, 24.15;
-0.76, 24.65;
-0.11, 25.16;
-0.01, 25.67;
0.16, 26.19;
0.14, 26.69;
0.29, 27.21;
0.22, 27.72;
0.17, 28.23;
0.13, 28.74;
0.10, 29.26;
0.08, 29.78;
0.06, 30.29;
0.04, 30.80;
0.03, 31.32;
0.02, 31.84;
0.81, 32.36;
0.66, 32.86;
0.08, 33.37;
0.16, 33.88;
-0.08, 34.40;
-0.20, 34.91;
-0.30, 35.43;
-0.23, 35.94;
-0.18, 36.46;
-0.14, 36.96;
-0.11, 37.48;
-0.08, 37.99;
-0.06, 38.51;
-0.05, 39.02;
-0.04, 39.54;
-0.02, 40.05;
-0.15, 40.57;
-0.56, 41.07;
-0.48, 41.58;
-0.07, 42.09;
0.17, 42.60;
0.05, 43.12;
0.33, 43.64;
0.25, 44.14;
0.19, 44.66;
0.15, 45.17;
0.11, 45.68;
0.09, 46.19;
0.06, 46.71;
0.05, 47.22;
0.04, 47.74;
0.03, 48.24;
0.02, 48.76;
0.95, 49.27;
0.45, 49.78;
-0.01, 50.29;
-0.02, 50.81;
-0.14, 51.32;
-0.15, 51.84;
-0.26, 52.34;
-0.19, 52.86;
-0.15, 53.37;
-0.11, 53.89;
-0.09, 54.40;
-0.07, 54.92;
-0.05, 55.44;
-0.04, 55.95;
-0.03, 56.46;
-0.03, 56.98;
-0.97, 57.50;
-0.62, 58.00;
-0.08, 58.51;
0.13, 59.03;
0.15, 59.54;
0.22, 60.06;
0.27, 60.57;
0.21, 61.09;
0.16, 61.60;
0.12, 62.11;
0.10, 62.62;
0.07, 63.14;
0.06, 63.66;
0.04, 64.18;
0.03, 64.70;
0.02, 65.23;
1.11, 65.76;
0.52, 66.30;
0.13, 66.84;
-0.15, 67.39;
-0.05, 67.93;
-0.31, 68.47;
-0.26, 69.01;
-0.20, 69.54;
-0.15, 70.08;
-0.11, 70.62;
-0.09, 71.16;
-0.07, 71.70;
-0.05, 72.24;
-0.03, 72.78;
-0.03, 73.32;
-0.51, 73.86;
-0.55, 74.40;
-0.32, 74.94;
-0.00, 75.48;
0.19, 76.03;
0.28, 76.57;
0.29, 77.11;
0.22, 77.65;
0.17, 78.19;
0.12, 78.73;
0.09, 79.27;
0.07, 79.81;
0.06, 80.35;
0.04, 80.90;
0.03, 81.44;
0.02, 81.98;
1.10, 82.54;
0.53, 83.06;
-0.03, 83.60;
0.01, 84.14;
-0.17, 84.69;
-0.34, 85.23;
-0.25, 85.77;
-0.19, 86.31;
-0.14, 86.86;
-0.11, 87.40;
-0.08, 87.95;
-0.06, 88.50;
-0.05, 89.04;
-0.03, 89.58;
-0.03, 90.13;
-1.30, 90.68;
-0.66, 91.22;
-0.02, 91.76;
-0.09, 92.30;
0.16, 92.84;
0.14, 93.38;
0.27, 93.92;
0.20, 94.46;
0.15, 95.01;
0.11, 95.54;
0.09, 96.09;
0.07, 96.63;
0.05, 97.17;
0.04, 97.70;
0.03, 98.25;
0.03, 98.79;
0.77, 99.34;
0.00, 100.00;];

%%
Fs = 2000;
StopTime = 100;              % miliseconds
t = linspace(0, StopTime, length(IC04(:,2)))';

IC04(1:end,2) = t;

%%
YC04 = IC04(1:end,1);
XC04 = IC04(1:end,2);
L = length(YC04);
RMS = ones(L,1).*rms(YC04);

f = Fs*(0:(L/2))/L;
Y_ = fft(YC04);
P2 = abs(Y_/L);
P1 = P2(1:L/2+1);
P1(2:end-1) = 2*P1(2:end-1);

%% Sine wave
Fc = 60;                     % hertz
x = -127*sqrt(2)*sin(2*pi*t*120-(48*pi/180));
%x = -127*sqrt(2)*sin(2*pi*Fc*t);

%% Corrente e Tensão RMS
random = rand(150,1);
for i=1:150
    IrmsC04(i) = (rms(YC04)*1.05-rms(YC04)*0.95)*random(i)+rms(YC04)*0.95;
    VrmsC04(i) = (rms(x)*1.05-rms(x)*0.95)*random(i)+rms(x)*0.95;
end

IrmsC04 = IrmsC04';
VrmsC04 = VrmsC04';

%% Potência ativa, total e aparente
SC04 = VrmsC04.*IrmsC04;
PC04 = ones(length(VrmsC04),1)*(PL3+PL4);
for i=1:150
    PC04(i)=((PL3+PL4)*1.05-(PL3+PL4)*0.95)*random(i)+(PL3+PL4)*0.95;
end
QC04 = abs(sqrt(SC04.^2-PC04.^2));

%% Fator de potência
FpC04 = PC04./SC04;
if any(isnan(FpC04))
   FpC04 = 0;
end
%% Amplitude das harmônicas
[pks,locs] = findpeaks(P1,f,'MinPeakHeight',max(P1)/2);
findpeaks(P1,f,'MinPeakDistance',locs(1)*1.75)
[amp_harC04, f_har] = findpeaks(P1,f,'MinPeakDistance',locs(1)*1.75);
amp_harC04 = amp_harC04(1:length(amp_harC04)-1)';

MC04 = [IrmsC04 PC04 SC04 QC04 FpC04 zeros(150,7)];
for i=1:150
    MC04(i,6)=(amp_harC04(1)*1.05-amp_harC04(1)*0.95)*random(i)+amp_harC04(1)*0.95;
    MC04(i,7)=(amp_harC04(2)*1.05-amp_harC04(2)*0.95)*random(i)+amp_harC04(2)*0.95;
    MC04(i,8)=(amp_harC04(3)*1.05-amp_harC04(3)*0.95)*random(i)+amp_harC04(3)*0.95;
    MC04(i,9)=(amp_harC04(4)*1.05-amp_harC04(4)*0.95)*random(i)+amp_harC04(4)*0.95;
    MC04(i,10)=(amp_harC04(5)*1.05-amp_harC04(5)*0.95)*random(i)+amp_harC04(5)*0.95;
    MC04(i,11)=(amp_harC04(6)*1.05-amp_harC04(6)*0.95)*random(i)+amp_harC04(6)*0.95;
    MC04(i,12)=(amp_harC04(7)*1.05-amp_harC04(7)*0.95)*random(i)+amp_harC04(7)*0.95;
end
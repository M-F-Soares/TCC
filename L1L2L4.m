%L1 L2 L4
 IC14 = [0.14, 0.02;
0.11, 0.57;
0.08, 1.09;
0.06, 1.61;
0.05, 2.12;
0.03, 2.64;
1.70, 3.14;
0.62, 3.66;
0.11, 4.16;
-0.09, 4.68;
-0.07, 5.18;
-0.32, 5.70;
-0.40, 6.22;
-0.31, 6.73;
-0.24, 7.24;
-0.19, 7.77;
-0.14, 8.28;
-0.11, 8.80;
-0.09, 9.30;
-0.07, 9.82;
-0.05, 10.34;
-0.04, 10.85;
-1.70, 11.36;
-0.81, 11.88;
-0.14, 12.39;
0.07, 12.90;
0.06, 13.40;
0.26, 13.92;
0.42, 14.44;
0.32, 14.95;
0.24, 15.46;
0.19, 15.98;
0.15, 16.49;
0.11, 17.00;
0.09, 17.51;
0.07, 18.02;
0.05, 18.52;
0.05, 19.04;
1.35, 19.55;
1.13, 20.05;
0.18, 20.56;
0.14, 21.07;
-0.05, 21.58;
-0.33, 22.09;
-0.45, 22.60;
-0.35, 23.12;
-0.27, 23.63;
-0.21, 24.14;
-0.17, 24.64;
-0.12, 25.16;
-0.10, 25.68;
-0.07, 26.20;
-0.06, 26.71;
-0.05, 27.23;
-0.86, 27.74;
-0.91, 28.26;
-0.34, 28.76;
0.01, 29.27;
-0.04, 29.78;
0.22, 30.30;
0.48, 30.81;
0.37, 31.32;
0.29, 31.83;
0.22, 32.34;
0.17, 32.85;
0.13, 33.36;
0.10, 33.86;
0.08, 34.38;
0.07, 34.88;
0.04, 35.40;
0.04, 35.90;
1.55, 36.42;
0.68, 36.92;
0.29, 37.43;
-0.00, 37.94;
-0.24, 38.46;
-0.26, 38.96;
-0.40, 39.48;
-0.31, 40.00;
-0.24, 40.51;
-0.19, 41.02;
-0.14, 41.54;
-0.11, 42.06;
-0.09, 42.57;
-0.06, 43.09;
-0.05, 43.61;
-0.04, 44.12;
-1.55, 44.64;
-0.95, 45.14;
-0.14, 45.64;
-0.05, 46.16;
0.21, 46.68;
0.22, 47.19;
0.42, 47.70;
0.33, 48.21;
0.25, 48.72;
0.19, 49.22;
0.15, 49.74;
0.11, 50.24;
0.09, 50.76;
0.07, 51.27;
0.05, 51.78;
0.04, 52.29;
1.57, 52.80;
1.22, 53.30;
0.20, 53.81;
-0.02, 54.32;
-0.20, 54.84;
-0.26, 55.36;
-0.45, 55.87;
-0.35, 56.38;
-0.27, 56.90;
-0.21, 57.40;
-0.16, 57.92;
-0.13, 58.44;
-0.10, 58.96;
-0.07, 59.47;
-0.06, 60.00;
-0.05, 60.51;
-0.74, 61.03;
-1.09, 61.54;
-0.36, 62.06;
0.09, 62.56;
0.15, 63.08;
0.26, 63.60;
0.46, 64.12;
0.36, 64.63;
0.27, 65.15;
0.20, 65.69;
0.16, 66.23;
0.12, 66.77;
0.09, 67.31;
0.06, 67.85;
0.05, 68.40;
0.03, 68.94;
1.86, 69.48;
0.90, 70.02;
0.21, 70.56;
0.08, 71.09;
-0.21, 71.63;
-0.30, 72.17;
-0.41, 72.71;
-0.31, 73.25;
-0.23, 73.79;
-0.18, 74.34;
-0.14, 74.87;
-0.11, 75.42;
-0.08, 75.97;
-0.06, 76.52;
-0.05, 77.07;
-0.75, 77.62;
-0.88, 78.16;
-0.32, 78.70;
-0.10, 79.24;
0.06, 79.78;
0.23, 80.32;
0.43, 80.86;
0.33, 81.40;
0.25, 81.94;
0.20, 82.48;
0.14, 83.02;
0.11, 83.56;
0.08, 84.10;
0.06, 84.64;
0.05, 85.18;
0.03, 85.72;
1.58, 86.26;
0.82, 86.80;
0.07, 87.34;
-0.10, 87.88;
-0.11, 88.43;
-0.48, 88.98;
-0.37, 89.52;
-0.28, 90.06;
-0.22, 90.60;
-0.16, 91.14;
-0.13, 91.69;
-0.10, 92.23;
-0.08, 92.78;
-0.06, 93.33;
-0.05, 93.88;
-1.88, 94.42;
-1.03, 94.96;
-0.33, 95.50;
-0.05, 96.04;
0.17, 96.58;
0.27, 97.12;
0.40, 97.66;
0.31, 98.20;
0.23, 98.73;
0.18, 99.27;
0.00, 100.00;];

%%
Fs = 2000;
StopTime = 100;              % miliseconds
t = linspace(0, StopTime, length(IC14(:,2)))';

IC14(1:end,2) = t;

%%
YC14 = IC14(1:end,1);
XC14 = IC14(1:end,2);
L = length(YC14);
RMS = ones(L,1).*rms(YC14);

f = Fs*(0:(L/2))/L;
Y_ = fft(YC14);
P2 = abs(Y_/L);
P1 = P2(1:L/2+1);
P1(2:end-1) = 2*P1(2:end-1);

%% Sine wave
Fc = 60;                     % hertz
x = -127*sqrt(2)*sin(2*pi*t*120-(48*pi/180));
%x = -127*sqrt(2)*sin(2*pi*Fc*t);

%% Corrente e Tensão RMS
random = rand(150,1);
for i=1:150
    IrmsC14(i) = (rms(YC14)*1.05-rms(YC14)*0.95)*random(i)+rms(YC14)*0.95;
    VrmsC14(i) = (rms(x)*1.05-rms(x)*0.95)*random(i)+rms(x)*0.95;
end

IrmsC14 = IrmsC14';
VrmsC14 = VrmsC14';

%% Potência ativa, total e aparente
SC14 = VrmsC14.*IrmsC14;
PC14 = ones(length(VrmsC14),1)*(PL1+PL2+PL4);
for i=1:150
    PC14(i)=((PL1+PL2+PL4)*1.05-(PL1+PL2+PL4)*0.95)*random(i)+(PL1+PL2+PL4)*0.95;
end
QC14 = abs(sqrt(SC14.^2-PC14.^2));

%% Fator de potência
FpC14 = PC14./SC14;
if any(isnan(FpC14))
   FpC14 = 0;
end
%% Amplitude das harmônicas
[pks,locs] = findpeaks(P1,f,'MinPeakHeight',max(P1)/2);
findpeaks(P1,f,'MinPeakDistance',locs(1)*1.75)
[amp_harC14, f_har] = findpeaks(P1,f,'MinPeakDistance',locs(1)*1.75);
amp_harC14 = amp_harC14(1:length(amp_harC14)-1)';

MC14 = [IrmsC14 PC14 SC14 QC14 FpC14 zeros(150,7)];
for i=1:150
    MC14(i,6)=(amp_harC14(1)*1.05-amp_harC14(1)*0.95)*random(i)+amp_harC14(1)*0.95;
    MC14(i,7)=(amp_harC14(2)*1.05-amp_harC14(2)*0.95)*random(i)+amp_harC14(2)*0.95;
    MC14(i,8)=(amp_harC14(3)*1.05-amp_harC14(3)*0.95)*random(i)+amp_harC14(3)*0.95;
    MC14(i,9)=(amp_harC14(4)*1.05-amp_harC14(4)*0.95)*random(i)+amp_harC14(4)*0.95;
    MC14(i,10)=(amp_harC14(5)*1.05-amp_harC14(5)*0.95)*random(i)+amp_harC14(5)*0.95;
    MC14(i,11)=(amp_harC14(6)*1.05-amp_harC14(6)*0.95)*random(i)+amp_harC14(6)*0.95;
    MC14(i,12)=(amp_harC14(7)*1.05-amp_harC14(7)*0.95)*random(i)+amp_harC14(7)*0.95;
end
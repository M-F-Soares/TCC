%L2 L3
 IC07 = [0.10, 0.02;
0.08, 0.57;
0.06, 1.09;
0.04, 1.60;
0.03, 2.12;
0.03, 2.64;
0.84, 3.14;
0.89, 3.66;
0.24, 4.16;
0.11, 4.67;
-0.17, 5.18;
-0.20, 5.70;
-0.31, 6.22;
-0.24, 6.73;
-0.19, 7.24;
-0.14, 7.77;
-0.11, 8.28;
-0.09, 8.80;
-0.06, 9.30;
-0.05, 9.82;
-0.04, 10.34;
-0.03, 10.85;
-0.32, 11.36;
-0.86, 11.88;
-0.33, 12.39;
0.06, 12.90;
-0.02, 13.42;
0.10, 13.93;
0.32, 14.44;
0.24, 14.95;
0.19, 15.46;
0.14, 15.98;
0.11, 16.49;
0.08, 17.00;
0.07, 17.50;
0.05, 18.02;
0.04, 18.52;
0.03, 19.03;
0.01, 19.54;
1.05, 20.06;
0.37, 20.61;
-0.07, 21.12;
0.03, 21.64;
-0.20, 22.16;
-0.39, 22.67;
-0.26, 23.18;
-0.20, 23.69;
-0.15, 24.21;
-0.12, 24.72;
-0.09, 25.24;
-0.07, 25.75;
-0.06, 26.27;
-0.04, 26.78;
-0.03, 27.30;
-0.02, 27.81;
-0.92, 28.34;
-0.51, 28.84;
0.04, 29.35;
-0.05, 29.86;
0.20, 30.38;
0.14, 30.89;
0.26, 31.41;
0.21, 31.92;
0.16, 32.44;
0.12, 32.95;
0.10, 33.46;
0.07, 33.97;
0.05, 34.48;
0.04, 35.00;
0.03, 35.51;
0.03, 36.02;
1.25, 36.53;
0.75, 37.04;
0.26, 37.55;
0.11, 38.06;
-0.24, 38.57;
-0.21, 39.08;
-0.29, 39.60;
-0.23, 40.11;
-0.17, 40.62;
-0.13, 41.13;
-0.10, 41.65;
-0.08, 42.17;
-0.06, 42.68;
-0.05, 43.20;
-0.03, 43.72;
-0.03, 44.23;
-0.95, 44.75;
-0.57, 45.26;
-0.20, 45.77;
-0.11, 46.28;
-0.01, 46.80;
0.12, 47.31;
0.30, 47.82;
0.23, 48.33;
0.18, 48.84;
0.14, 49.34;
0.10, 49.86;
0.08, 50.36;
0.06, 50.88;
0.05, 51.40;
0.04, 51.91;
0.02, 52.42;
0.45, 52.94;
0.55, 53.45;
0.45, 53.96;
0.03, 54.47;
0.03, 54.99;
-0.32, 55.50;
-0.33, 56.02;
-0.25, 56.52;
-0.20, 57.04;
-0.14, 57.56;
-0.11, 58.07;
-0.09, 58.58;
-0.07, 59.10;
-0.05, 59.62;
-0.04, 60.13;
-0.03, 60.65;
-0.03, 61.17;
-1.01, 61.68;
-0.31, 62.19;
-0.05, 62.70;
-0.04, 63.22;
0.19, 63.73;
0.27, 64.24;
0.26, 64.76;
0.20, 65.29;
0.15, 65.83;
0.11, 66.37;
0.08, 66.91;
0.07, 67.46;
0.05, 67.99;
0.04, 68.52;
0.03, 69.06;
0.60, 69.60;
0.67, 70.13;
0.36, 70.67;
0.07, 71.21;
-0.03, 71.75;
-0.08, 72.30;
-0.29, 72.83;
-0.22, 73.38;
-0.17, 73.92;
-0.12, 74.46;
-0.10, 75.00;
-0.07, 75.55;
-0.06, 76.09;
-0.04, 76.64;
-0.04, 77.18;
-0.02, 77.72;
-0.88, 78.27;
-0.19, 78.81;
0.03, 79.35;
0.14, 79.90;
0.28, 80.44;
0.31, 80.97;
0.24, 81.52;
0.18, 82.05;
0.14, 82.60;
0.10, 83.13;
0.08, 83.68;
0.06, 84.22;
0.04, 84.76;
0.03, 85.30;
0.02, 85.84;
1.08, 86.38;
0.54, 86.91;
0.10, 87.45;
0.09, 87.99;
-0.23, 88.53;
-0.32, 89.06;
-0.27, 89.60;
-0.21, 90.14;
-0.16, 90.69;
-0.12, 91.23;
-0.09, 91.78;
-0.07, 92.32;
-0.05, 92.88;
-0.04, 93.42;
-0.03, 93.97;
-0.59, 94.52;
-0.85, 95.06;
-0.08, 95.60;
-0.11, 96.14;
-0.04, 96.68;
0.11, 97.22;
0.29, 97.76;
0.22, 98.31;
0.17, 98.85;
0.12, 99.39;
0.00, 99.95;];

%%
Fs = 2000;
StopTime = 100;              % miliseconds
t = linspace(0, StopTime, length(IC07(:,2)))';

IC07(1:end,2) = t;

%%
YC07 = IC07(1:end,1);
XC07 = IC07(1:end,2);
L = length(YC07);
RMS = ones(L,1).*rms(YC07);

f = Fs*(0:(L/2))/L;
Y_ = fft(YC07);
P2 = abs(Y_/L);
P1 = P2(1:L/2+1);
P1(2:end-1) = 2*P1(2:end-1);

%% Sine wave
Fc = 60;                     % hertz
x = -127*sqrt(2)*sin(2*pi*t*120-(48*pi/180));
%x = -127*sqrt(2)*sin(2*pi*Fc*t);

%% Corrente e Tensão RMS
random = rand(150,1);
for i=1:150
    IrmsC07(i) = (rms(YC07)*1.05-rms(YC07)*0.95)*random(i)+rms(YC07)*0.95;
    VrmsC07(i) = (rms(x)*1.05-rms(x)*0.95)*random(i)+rms(x)*0.95;
end

IrmsC07 = IrmsC07';
VrmsC07 = VrmsC07';

%% Potência ativa, total e aparente
SC07 = VrmsC07.*IrmsC07;
PC07 = ones(length(VrmsC07),1)*(PL2+PL3);
for i=1:150
    PC07(i)=((PL2+PL3)*1.05-(PL2+PL3)*0.95)*random(i)+(PL2+PL3)*0.95;
end
QC07 = abs(sqrt(SC07.^2-PC07.^2));

%% Fator de potência
FpC07 = PC07./SC07;
if any(isnan(FpC07))
   FpC07 = 0;
end
%% Amplitude das harmônicas
[pks,locs] = findpeaks(P1,f,'MinPeakHeight',max(P1)/2);
findpeaks(P1,f,'MinPeakDistance',locs(1)*1.75)
[amp_harC07, f_har] = findpeaks(P1,f,'MinPeakDistance',locs(1)*1.75);
amp_harC07 = amp_harC07(1:length(amp_harC07)-1)';

MC07 = [IrmsC07 PC07 SC07 QC07 FpC07 zeros(150,7)];
for i=1:150
    MC07(i,6)=(amp_harC07(1)*1.05-amp_harC07(1)*0.95)*random(i)+amp_harC07(1)*0.95;
    MC07(i,7)=(amp_harC07(2)*1.05-amp_harC07(2)*0.95)*random(i)+amp_harC07(2)*0.95;
    MC07(i,8)=(amp_harC07(3)*1.05-amp_harC07(3)*0.95)*random(i)+amp_harC07(3)*0.95;
    MC07(i,9)=(amp_harC07(4)*1.05-amp_harC07(4)*0.95)*random(i)+amp_harC07(4)*0.95;
    MC07(i,10)=(amp_harC07(5)*1.05-amp_harC07(5)*0.95)*random(i)+amp_harC07(5)*0.95;
    MC07(i,11)=(amp_harC07(6)*1.05-amp_harC07(6)*0.95)*random(i)+amp_harC07(6)*0.95;
    MC07(i,12)=(amp_harC07(7)*1.05-amp_harC07(7)*0.95)*random(i)+amp_harC07(7)*0.95;
end
%L1 L2 L3 L4
 IC16 = [-0.05, 0.02;
-0.29, 0.58;
-0.33, 1.08;
-0.56, 1.60;
-0.43, 2.11;
-0.33, 2.62;
-0.26, 3.12;
-0.21, 3.64;
-0.15, 4.15;
-0.12, 4.67;
-0.09, 5.17;
-0.07, 5.68;
-0.06, 6.19;
-1.87, 6.71;
-1.44, 7.22;
-0.54, 7.73;
-0.11, 8.28;
0.34, 8.80;
0.46, 9.31;
0.59, 9.81;
0.46, 10.32;
0.36, 10.83;
0.28, 11.34;
0.22, 11.84;
0.17, 12.36;
0.13, 12.87;
0.11, 13.38;
0.08, 13.90;
0.06, 14.40;
0.98, 14.93;
1.21, 15.43;
0.62, 15.95;
0.00, 16.45;
-0.26, 16.96;
-0.36, 17.47;
-0.65, 17.98;
-0.49, 18.49;
-0.38, 19.00;
-0.30, 19.50;
-0.23, 20.01;
-0.18, 20.52;
-0.14, 21.03;
-0.11, 21.54;
-0.08, 22.06;
-0.06, 22.57;
-0.05, 23.09;
-1.87, 23.61;
-0.98, 24.11;
-0.31, 24.61;
0.26, 25.12;
0.35, 25.62;
0.49, 26.13;
0.54, 26.64;
0.42, 27.14;
0.33, 27.66;
0.25, 28.17;
0.20, 28.68;
0.15, 29.19;
0.12, 29.70;
0.09, 30.22;
0.07, 30.73;
0.06, 31.25;
1.87, 31.77;
1.20, 32.28;
0.46, 32.78;
-0.11, 33.28;
-0.18, 33.80;
-0.24, 34.31;
-0.57, 34.82;
-0.44, 35.32;
-0.35, 35.83;
-0.27, 36.34;
-0.20, 36.85;
-0.16, 37.36;
-0.12, 37.86;
-0.10, 38.37;
-0.07, 38.89;
-0.05, 39.40;
-1.58, 39.92;
-1.48, 40.43;
-0.64, 40.94;
0.05, 41.45;
0.19, 41.97;
0.43, 42.48;
0.62, 43.00;
0.48, 43.50;
0.37, 44.02;
0.29, 44.52;
0.22, 45.04;
0.17, 45.55;
0.14, 46.07;
0.11, 46.58;
0.08, 47.10;
0.07, 47.61;
0.35, 48.13;
1.74, 48.63;
0.87, 49.14;
0.30, 49.65;
-0.25, 50.16;
-0.20, 50.67;
-0.72, 51.18;
-0.50, 51.68;
-0.40, 52.20;
-0.30, 52.70;
-0.23, 53.22;
-0.18, 53.73;
-0.14, 54.24;
-0.11, 54.75;
-0.08, 55.27;
-0.06, 55.78;
-0.04, 56.29;
-1.87, 56.81;
-1.16, 57.32;
-0.12, 57.82;
0.18, 58.34;
0.23, 58.84;
0.30, 59.36;
0.55, 59.86;
0.43, 60.37;
0.34, 60.88;
0.26, 61.38;
0.20, 61.89;
0.16, 62.40;
0.12, 62.92;
0.10, 63.43;
0.08, 63.95;
0.07, 64.46;
1.87, 64.98;
1.58, 65.50;
0.39, 66.03;
-0.20, 66.57;
-0.28, 67.12;
-0.47, 67.65;
-0.53, 68.19;
-0.42, 68.72;
-0.32, 69.26;
-0.24, 69.80;
-0.18, 70.34;
-0.14, 70.88;
-0.11, 71.43;
-0.08, 71.96;
-0.06, 72.51;
-0.33, 73.05;
-1.37, 73.59;
-0.81, 74.12;
-0.20, 74.66;
0.25, 75.20;
0.32, 75.73;
0.61, 76.27;
0.47, 76.81;
0.36, 77.36;
0.28, 77.89;
0.22, 78.44;
0.16, 78.98;
0.12, 79.52;
0.10, 80.06;
0.07, 80.60;
0.05, 81.14;
1.87, 81.69;
1.40, 82.22;
0.19, 82.76;
-0.20, 83.30;
-0.37, 83.84;
-0.51, 84.37;
-0.52, 84.91;
-0.41, 85.44;
-0.30, 85.98;
-0.23, 86.52;
-0.18, 87.06;
-0.13, 87.61;
-0.10, 88.14;
-0.08, 88.69;
-0.06, 89.22;
-0.88, 89.78;
-1.35, 90.31;
-0.71, 90.84;
0.00, 91.38;
0.27, 91.93;
0.15, 92.47;
0.58, 93.02;
0.44, 93.55;
0.34, 94.09;
0.26, 94.63;
0.20, 95.17;
0.16, 95.70;
0.12, 96.24;
0.09, 96.78;
0.07, 97.32;
0.05, 97.86;
1.87, 98.40;
1.12, 98.94;
0.07, 99.48;];

%%
Fs = 2000;
StopTime = 100;              % miliseconds
t = linspace(0, StopTime, length(IC16(:,2)))';

IC16(1:end,2) = t;

%%
YC16 = IC16(1:end,1);
XC16 = IC16(1:end,2);
L = length(YC16);
RMS = ones(L,1).*rms(YC16);

f = Fs*(0:(L/2))/L;
Y_ = fft(YC16);
P2 = abs(Y_/L);
P1 = P2(1:L/2+1);
P1(2:end-1) = 2*P1(2:end-1);

%% Sine wave
Fc = 60;                     % hertz
x = -127*sqrt(2)*sin(2*pi*t*120-(48*pi/180));
%x = -127*sqrt(2)*sin(2*pi*Fc*t);

%% Corrente e Tensão RMS
random = rand(150,1);
for i=1:150
    IrmsC16(i) = (rms(YC16)*1.05-rms(YC16)*0.95)*random(i)+rms(YC16)*0.95;
    VrmsC16(i) = (rms(x)*1.05-rms(x)*0.95)*random(i)+rms(x)*0.95;
end

IrmsC16 = IrmsC16';
VrmsC16 = VrmsC16';

%% Potência ativa, total e aparente
SC16 = VrmsC16.*IrmsC16;
PC16 = ones(length(VrmsC16),1)*(PL1+PL2+PL3+PL4);
for i=1:150
    PC16(i)=((PL1+PL2+PL3+PL4)*1.05-(PL1+PL2+PL3+PL4)*0.95)*random(i)+(PL1+PL2+PL3+PL4)*0.95;
end
QC16 = abs(sqrt(SC16.^2-PC16.^2));

%% Fator de potência
FpC16 = PC16./SC16;
if any(isnan(FpC16))
   FpC16 = 0;
end
%% Amplitude das harmônicas
[pks,locs] = findpeaks(P1,f,'MinPeakHeight',max(P1)/2);
findpeaks(P1,f,'MinPeakDistance',locs(1)*1.75)
[amp_harC16, f_har] = findpeaks(P1,f,'MinPeakDistance',locs(1)*1.75);
amp_harC16 = amp_harC16(1:length(amp_harC16)-1)';

MC16 = [IrmsC16 PC16 SC16 QC16 FpC16 zeros(150,7)];
for i=1:150
    MC16(i,6)=(amp_harC16(1)*1.05-amp_harC16(1)*0.95)*random(i)+amp_harC16(1)*0.95;
    MC16(i,7)=(amp_harC16(2)*1.05-amp_harC16(2)*0.95)*random(i)+amp_harC16(2)*0.95;
    MC16(i,8)=(amp_harC16(3)*1.05-amp_harC16(3)*0.95)*random(i)+amp_harC16(3)*0.95;
    MC16(i,9)=(amp_harC16(4)*1.05-amp_harC16(4)*0.95)*random(i)+amp_harC16(4)*0.95;
    MC16(i,10)=(amp_harC16(5)*1.05-amp_harC16(5)*0.95)*random(i)+amp_harC16(5)*0.95;
    MC16(i,11)=(amp_harC16(6)*1.05-amp_harC16(6)*0.95)*random(i)+amp_harC16(6)*0.95;
    MC16(i,12)=(amp_harC16(7)*1.05-amp_harC16(7)*0.95)*random(i)+amp_harC16(7)*0.95;
end
%L1 L3
 IC11 = [-0.11, 0.02;
0.00, 0.58;
-0.27, 1.10;
-0.30, 1.62;
-0.23, 2.12;
-0.17, 2.64;
-0.13, 3.14;
-0.10, 3.66;
-0.08, 4.17;
-0.06, 4.69;
-0.04, 5.20;
-0.04, 5.72;
-0.02, 6.23;
-0.29, 6.75;
-0.72, 7.26;
-0.11, 7.78;
0.08, 8.28;
0.10, 8.79;
0.03, 9.30;
0.34, 9.82;
0.24, 10.32;
0.19, 10.83;
0.14, 11.34;
0.11, 11.85;
0.09, 12.36;
0.06, 12.88;
0.05, 13.38;
0.04, 13.90;
0.03, 14.42;
0.02, 14.93;
1.03, 15.45;
0.45, 15.96;
0.20, 16.46;
-0.18, 16.98;
-0.04, 17.48;
-0.14, 18.00;
-0.26, 18.51;
-0.20, 19.02;
-0.15, 19.53;
-0.11, 20.05;
-0.09, 20.56;
-0.07, 21.06;
-0.05, 21.57;
-0.04, 22.09;
-0.02, 22.61;
-0.02, 23.12;
-1.11, 23.63;
-0.73, 24.13;
-0.32, 24.63;
0.10, 25.14;
0.16, 25.66;
0.30, 26.17;
0.28, 26.68;
0.21, 27.19;
0.17, 27.70;
0.13, 28.22;
0.10, 28.73;
0.07, 29.24;
0.06, 29.75;
0.05, 30.27;
0.03, 30.78;
0.03, 31.30;
0.83, 31.82;
0.75, 32.33;
0.14, 32.83;
0.11, 33.34;
-0.11, 33.85;
-0.07, 34.37;
-0.29, 34.89;
-0.23, 35.40;
-0.17, 35.91;
-0.13, 36.42;
-0.11, 36.93;
-0.08, 37.45;
-0.06, 37.96;
-0.04, 38.48;
-0.04, 39.00;
-0.03, 39.52;
-0.45, 40.03;
-0.60, 40.54;
-0.29, 41.05;
0.11, 41.56;
-0.01, 42.07;
0.21, 42.59;
0.21, 43.10;
0.24, 43.62;
0.19, 44.12;
0.14, 44.63;
0.11, 45.14;
0.08, 45.66;
0.07, 46.17;
0.05, 46.69;
0.04, 47.21;
0.03, 47.73;
0.02, 48.23;
0.92, 48.74;
0.45, 49.25;
0.13, 49.76;
-0.17, 50.27;
-0.11, 50.79;
-0.35, 51.30;
-0.25, 51.82;
-0.19, 52.32;
-0.15, 52.84;
-0.11, 53.35;
-0.09, 53.86;
-0.07, 54.37;
-0.05, 54.89;
-0.04, 55.41;
-0.03, 55.92;
-0.02, 56.44;
-1.12, 56.95;
-0.66, 57.45;
-0.13, 57.96;
0.11, 58.48;
0.13, 59.00;
0.26, 59.51;
0.27, 60.02;
0.21, 60.53;
0.16, 61.05;
0.12, 61.56;
0.10, 62.08;
0.07, 62.59;
0.06, 63.11;
0.04, 63.62;
0.03, 64.14;
0.02, 64.66;
1.19, 65.19;
0.55, 65.72;
0.05, 66.26;
0.11, 66.80;
-0.07, 67.34;
-0.10, 67.88;
-0.26, 68.42;
-0.20, 68.96;
-0.15, 69.50;
-0.11, 70.04;
-0.09, 70.58;
-0.07, 71.12;
-0.05, 71.66;
-0.03, 72.21;
-0.03, 72.75;
-0.39, 73.30;
-0.55, 73.83;
-0.28, 74.37;
0.07, 74.91;
0.12, 75.46;
0.23, 75.99;
0.29, 76.53;
0.22, 77.07;
0.17, 77.62;
0.12, 78.15;
0.09, 78.69;
0.07, 79.23;
0.05, 79.78;
0.04, 80.32;
0.03, 80.86;
0.02, 81.40;
1.02, 81.94;
0.26, 82.48;
0.19, 83.02;
-0.01, 83.56;
-0.28, 84.11;
-0.36, 84.65;
-0.23, 85.19;
-0.18, 85.73;
-0.14, 86.27;
-0.11, 86.82;
-0.08, 87.36;
-0.06, 87.91;
-0.04, 88.46;
-0.03, 89.00;
-0.03, 89.54;
-1.09, 90.08;
-0.63, 90.62;
-0.24, 91.16;
0.03, 91.70;
0.16, 92.24;
0.28, 92.79;
0.27, 93.33;
0.20, 93.87;
0.15, 94.41;
0.11, 94.95;
0.09, 95.49;
0.07, 96.04;
0.05, 96.58;
0.03, 97.12;
0.03, 97.66;
0.19, 98.21;
0.79, 98.75;
0.22, 99.28;
0.00, 100.00;];

%%
Fs = 2000;
StopTime = 100;              % miliseconds
t = linspace(0, StopTime, length(IC11(:,2)))';

IC11(1:end,2) = t;

%%
YC11 = IC11(1:end,1);
XC11 = IC11(1:end,2);
L = length(YC11);
RMS = ones(L,1).*rms(YC11);

f = Fs*(0:(L/2))/L;
Y_ = fft(YC11);
P2 = abs(Y_/L);
P1 = P2(1:L/2+1);
P1(2:end-1) = 2*P1(2:end-1);

%% Sine wave
Fc = 60;                     % hertz
x = -127*sqrt(2)*sin(2*pi*t*120-(48*pi/180));
%x = -127*sqrt(2)*sin(2*pi*Fc*t);

%% Corrente e Tensão RMS
random = rand(150,1);
for i=1:150
    IrmsC11(i) = (rms(YC11)*1.05-rms(YC11)*0.95)*random(i)+rms(YC11)*0.95;
    VrmsC11(i) = (rms(x)*1.05-rms(x)*0.95)*random(i)+rms(x)*0.95;
end

IrmsC11 = IrmsC11';
VrmsC11 = VrmsC11';

%% Potência ativa, total e aparente
SC11 = VrmsC11.*IrmsC11;
PC11 = ones(length(VrmsC11),1)*(PL1+PL3);
for i=1:150
    PC11(i)=((PL1+PL3)*1.05-(PL1+PL3)*0.95)*random(i)+(PL1+PL3)*0.95;
end
QC11 = abs(sqrt(SC11.^2-PC11.^2));

%% Fator de potência
FpC11 = PC11./SC11;
if any(isnan(FpC11))
   FpC11 = 0;
end
%% Amplitude das harmônicas
[pks,locs] = findpeaks(P1,f,'MinPeakHeight',max(P1)/2);
findpeaks(P1,f,'MinPeakDistance',locs(1)*1.75)
[amp_harC11, f_har] = findpeaks(P1,f,'MinPeakDistance',locs(1)*1.75);
amp_harC11 = amp_harC11(1:length(amp_harC11)-1)';

MC11 = [IrmsC11 PC11 SC11 QC11 FpC11 zeros(150,7)];
for i=1:150
    MC11(i,6)=(amp_harC11(1)*1.05-amp_harC11(1)*0.95)*random(i)+amp_harC11(1)*0.95;
    MC11(i,7)=(amp_harC11(2)*1.05-amp_harC11(2)*0.95)*random(i)+amp_harC11(2)*0.95;
    MC11(i,8)=(amp_harC11(3)*1.05-amp_harC11(3)*0.95)*random(i)+amp_harC11(3)*0.95;
    MC11(i,9)=(amp_harC11(4)*1.05-amp_harC11(4)*0.95)*random(i)+amp_harC11(4)*0.95;
    MC11(i,10)=(amp_harC11(5)*1.05-amp_harC11(5)*0.95)*random(i)+amp_harC11(5)*0.95;
    MC11(i,11)=(amp_harC11(6)*1.05-amp_harC11(6)*0.95)*random(i)+amp_harC11(6)*0.95;
    MC11(i,12)=(amp_harC11(7)*1.05-amp_harC11(7)*0.95)*random(i)+amp_harC11(7)*0.95;
end
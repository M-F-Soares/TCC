% %25W L4
 IC02 = [-0.06, 0.02;
-0.05, 0.58;
-0.04, 1.09;
-0.03, 1.61;
-0.02, 2.12;
-0.01, 2.64;
-0.01, 3.14;
-0.01, 3.66;
-0.45, 4.17;
-0.18, 4.68;
0.05, 5.20;
0.08, 5.72;
0.10, 6.23;
0.15, 6.75;
0.11, 7.26;
0.08, 7.78;
0.06, 8.29;
0.05, 8.80;
0.03, 9.32;
0.03, 9.84;
0.02, 10.35;
0.02, 10.87;
0.01, 11.38;
0.01, 11.90;
0.38, 12.41;
0.31, 12.92;
0.07, 13.43;
-0.01, 13.95;
-0.02, 14.47;
-0.17, 14.99;
-0.12, 15.50;
-0.10, 16.02;
-0.07, 16.53;
-0.06, 17.05;
-0.04, 17.56;
-0.03, 18.08;
-0.03, 18.59;
-0.02, 19.11;
-0.02, 19.62;
-0.01, 20.14;
-0.52, 20.66;
-0.27, 21.17;
-0.09, 21.67;
0.12, 22.18;
-0.04, 22.69;
0.17, 23.21;
0.12, 23.72;
0.09, 24.23;
0.07, 24.74;
0.06, 25.26;
0.04, 25.77;
0.03, 26.28;
0.02, 26.80;
0.01, 27.32;
0.01, 27.83;
0.01, 28.35;
0.47, 28.85;
0.38, 29.37;
0.20, 29.87;
-0.02, 30.39;
0.02, 30.90;
-0.10, 31.42;
-0.13, 31.94;
-0.10, 32.46;
-0.08, 32.98;
-0.06, 33.49;
-0.05, 34.00;
-0.03, 34.52;
-0.03, 35.03;
-0.02, 35.55;
-0.01, 36.06;
-0.01, 36.58;
-0.29, 37.10;
-0.33, 37.62;
-0.05, 38.12;
0.07, 38.64;
0.03, 39.15;
0.02, 39.67;
0.14, 40.17;
0.10, 40.69;
0.08, 41.20;
0.06, 41.71;
0.04, 42.22;
0.03, 42.74;
0.03, 43.24;
0.02, 43.75;
0.02, 44.26;
0.01, 44.78;
0.01, 45.29;
0.35, 45.80;
0.23, 46.31;
-0.01, 46.82;
-0.04, 47.35;
-0.06, 47.86;
-0.15, 48.36;
-0.11, 48.88;
-0.09, 49.40;
-0.06, 49.92;
-0.06, 50.43;
-0.04, 50.95;
-0.03, 51.46;
-0.02, 51.98;
-0.02, 52.50;
-0.01, 53.01;
-0.01, 53.53;
-0.51, 54.05;
-0.20, 54.55;
-0.09, 55.06;
0.11, 55.57;
0.02, 56.09;
0.12, 56.60;
0.11, 57.11;
0.09, 57.62;
0.07, 58.13;
0.05, 58.64;
0.04, 59.16;
0.03, 59.67;
0.02, 60.19;
0.02, 60.70;
0.01, 61.22;
0.01, 61.73;
0.54, 62.25;
0.35, 62.76;
0.04, 63.27;
-0.00, 63.78;
0.00, 64.31;
-0.13, 64.83;
-0.13, 65.37;
-0.09, 65.91;
-0.07, 66.45;
-0.06, 67.00;
-0.04, 67.54;
-0.03, 68.08;
-0.03, 68.62;
-0.02, 69.17;
-0.02, 69.72;
-0.01, 70.26;
-0.42, 70.80;
-0.18, 71.35;
-0.04, 71.88;
0.01, 72.43;
0.05, 72.97;
0.13, 73.52;
0.10, 74.06;
0.08, 74.60;
0.05, 75.14;
0.04, 75.68;
0.03, 76.22;
0.03, 76.75;
0.01, 77.29;
0.02, 77.84;
0.01, 78.39;
0.42, 78.94;
0.27, 79.48;
-0.02, 80.01;
-0.03, 80.56;
-0.05, 81.10;
-0.14, 81.64;
-0.11, 82.18;
-0.08, 82.73;
-0.06, 83.27;
-0.05, 83.82;
-0.04, 84.36;
-0.03, 84.90;
-0.02, 85.45;
-0.01, 86.00;
-0.01, 86.55;
-0.59, 87.09;
-0.38, 87.64;
-0.07, 88.17;
-0.03, 88.72;
0.13, 89.26;
0.05, 89.80;
0.12, 90.34;
0.09, 90.88;
0.07, 91.43;
0.05, 91.98;
0.04, 92.52;
0.03, 93.06;
0.02, 93.60;
0.01, 94.14;
0.01, 94.69;
0.01, 95.23;
0.30, 95.78;
0.16, 96.32;
-0.08, 96.86;
-0.08, 97.40;
-0.08, 97.95;
-0.13, 98.50;
-0.10, 99.05;
0.00, 99.96;
0.00, 100.00;];

%%
Fs = 2000;
StopTime = 100;              % miliseconds
t = linspace(0, StopTime, length(IC02(:,2)))';

IC02(1:end,2) = t;

%%
YC02 = IC02(1:end,1);
XC02 = IC02(1:end,2);
L = length(YC02);
RMS = ones(L,1).*rms(YC02);

f = Fs*(0:(L/2))/L;
Y_ = fft(YC02);
P2 = abs(Y_/L);
P1 = P2(1:L/2+1);
P1(2:end-1) = 2*P1(2:end-1);

%% Sine wave
Fc = 60;                     % hertz
x = -127*sqrt(2)*sin(2*pi*t*120-(48*pi/180));
%x = -127*sqrt(2)*sin(2*pi*Fc*t);

%% Corrente e Tensão RMS
random = rand(150,1);
for i=1:150
    IrmsC02(i) = (rms(YC02)*1.05-rms(YC02)*0.95)*random(i)+rms(YC02)*0.95;
    VrmsC02(i) = (rms(x)*1.05-rms(x)*0.95)*random(i)+rms(x)*0.95;
end

IrmsC02 = IrmsC02';
VrmsC02 = VrmsC02';

%% Potência ativa, total e aparente
SC02 = VrmsC02.*IrmsC02;
PC02 = ones(length(VrmsC02),1)*PL4;
for i=1:150
    PC02(i)=(PL4*1.05-PL4*0.95)*random(i)+PL4*0.95;
end
QC02 = abs(sqrt(SC02.^2-PC02.^2));

%% Fator de potência
FpC02 = PC02./SC02;
if any(isnan(FpC02))
   FpC02 = 0;
end
%% Amplitude das harmônicas
[pks,locs] = findpeaks(P1,f,'MinPeakHeight',max(P1)/2);
findpeaks(P1,f,'MinPeakDistance',locs(1)*1.75)
[amp_harC02, f_har] = findpeaks(P1,f,'MinPeakDistance',locs(1)*1.75);
amp_harC02 = amp_harC02(1:length(amp_harC02)-1)';

MC02 = [IrmsC02 PC02 SC02 QC02 FpC02 zeros(150,7)];
for i=1:150
    MC02(i,6)=(amp_harC02(1)*1.05-amp_harC02(1)*0.95)*random(i)+amp_harC02(1)*0.95;
    MC02(i,7)=(amp_harC02(2)*1.05-amp_harC02(2)*0.95)*random(i)+amp_harC02(2)*0.95;
    MC02(i,8)=(amp_harC02(3)*1.05-amp_harC02(3)*0.95)*random(i)+amp_harC02(3)*0.95;
    MC02(i,9)=(amp_harC02(4)*1.05-amp_harC02(4)*0.95)*random(i)+amp_harC02(4)*0.95;
    MC02(i,10)=(amp_harC02(5)*1.05-amp_harC02(5)*0.95)*random(i)+amp_harC02(5)*0.95;
    MC02(i,11)=(amp_harC02(6)*1.05-amp_harC02(6)*0.95)*random(i)+amp_harC02(6)*0.95;
    MC02(i,12)=(amp_harC02(7)*1.05-amp_harC02(7)*0.95)*random(i)+amp_harC02(7)*0.95;
end
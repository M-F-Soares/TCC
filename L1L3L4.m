%L1 L3 L4
 IC12 = [-0.09, 0.02;
-0.08, 0.58;
-0.05, 1.09;
-0.04, 1.61;
-0.11, 2.12;
-1.24, 2.64;
-0.59, 3.14;
-0.26, 3.65;
0.19, 4.16;
0.20, 4.68;
0.54, 5.18;
0.36, 5.69;
0.28, 6.20;
0.22, 6.70;
0.18, 7.22;
0.13, 7.73;
0.10, 8.24;
0.08, 8.76;
0.06, 9.26;
0.04, 9.78;
0.03, 10.30;
1.41, 10.81;
0.59, 11.32;
0.24, 11.83;
-0.14, 12.34;
-0.33, 12.85;
-0.31, 13.36;
-0.39, 13.88;
-0.31, 14.40;
-0.24, 14.92;
-0.18, 15.43;
-0.14, 15.95;
-0.11, 16.46;
-0.08, 16.98;
-0.06, 17.50;
-0.05, 18.01;
-0.04, 18.52;
-1.48, 19.04;
-0.83, 19.54;
-0.40, 20.05;
0.08, 20.56;
-0.04, 21.07;
0.41, 21.58;
0.41, 22.10;
0.32, 22.60;
0.25, 23.11;
0.19, 23.62;
0.15, 24.12;
0.11, 24.64;
0.09, 25.15;
0.07, 25.66;
0.06, 26.17;
0.04, 26.68;
0.89, 27.20;
0.99, 27.71;
0.22, 28.22;
-0.10, 28.73;
-0.21, 29.25;
-0.32, 29.76;
-0.44, 30.28;
-0.35, 30.79;
-0.26, 31.31;
-0.20, 31.82;
-0.16, 32.34;
-0.12, 32.85;
-0.09, 33.36;
-0.07, 33.86;
-0.06, 34.38;
-0.04, 34.89;
-0.42, 35.40;
-1.31, 35.91;
-0.68, 36.42;
-0.19, 36.92;
0.26, 37.44;
0.07, 37.95;
0.48, 38.46;
0.37, 38.97;
0.28, 39.48;
0.22, 39.98;
0.17, 40.50;
0.13, 41.00;
0.10, 41.52;
0.08, 42.03;
0.06, 42.55;
0.05, 43.06;
0.03, 43.58;
1.59, 44.10;
0.86, 44.61;
0.43, 45.11;
-0.13, 45.62;
-0.29, 46.14;
-0.49, 46.65;
-0.39, 47.17;
-0.30, 47.68;
-0.23, 48.18;
-0.18, 48.70;
-0.14, 49.20;
-0.11, 49.71;
-0.08, 50.22;
-0.07, 50.74;
-0.05, 51.24;
-0.04, 51.76;
-1.47, 52.28;
-1.16, 52.79;
-0.27, 53.29;
-0.13, 53.81;
0.25, 54.32;
0.26, 54.83;
0.42, 55.34;
0.32, 55.84;
0.25, 56.35;
0.19, 56.86;
0.16, 57.37;
0.12, 57.89;
0.09, 58.40;
0.07, 58.92;
0.05, 59.43;
0.04, 59.95;
0.98, 60.46;
0.94, 60.98;
0.12, 61.48;
-0.01, 62.00;
-0.25, 62.52;
-0.34, 63.03;
-0.44, 63.54;
-0.34, 64.06;
-0.27, 64.57;
-0.20, 65.09;
-0.15, 65.63;
-0.11, 66.17;
-0.09, 66.71;
-0.07, 67.25;
-0.05, 67.79;
-0.03, 68.33;
-1.52, 68.87;
-1.18, 69.41;
-0.22, 69.94;
0.20, 70.48;
0.10, 71.02;
0.40, 71.56;
0.39, 72.10;
0.30, 72.64;
0.23, 73.17;
0.18, 73.71;
0.13, 74.24;
0.10, 74.79;
0.08, 75.34;
0.06, 75.87;
0.05, 76.42;
0.17, 76.96;
1.05, 77.51;
0.24, 78.04;
-0.05, 78.59;
-0.07, 79.13;
-0.12, 79.68;
-0.43, 80.21;
-0.33, 80.75;
-0.25, 81.28;
-0.20, 81.82;
-0.14, 82.36;
-0.11, 82.90;
-0.08, 83.44;
-0.06, 83.98;
-0.05, 84.52;
-0.03, 85.06;
-1.66, 85.61;
-0.62, 86.14;
-0.21, 86.69;
-0.09, 87.23;
0.10, 87.78;
0.36, 88.32;
0.37, 88.86;
0.28, 89.40;
0.21, 89.94;
0.16, 90.48;
0.13, 91.02;
0.10, 91.56;
0.08, 92.10;
0.06, 92.64;
0.05, 93.19;
1.41, 93.74;
1.01, 94.28;
0.44, 94.82;
0.15, 95.37;
-0.06, 95.92;
-0.36, 96.46;
-0.40, 97.00;
-0.30, 97.54;
-0.23, 98.08;
-0.18, 98.62;
-0.13, 99.16;
0.00, 99.96;];

%%
Fs = 2000;
StopTime = 100;              % miliseconds
t = linspace(0, StopTime, length(IC12(:,2)))';

IC12(1:end,2) = t;

%%
YC12 = IC12(1:end,1);
XC12 = IC12(1:end,2);
L = length(YC12);
RMS = ones(L,1).*rms(YC12);

f = Fs*(0:(L/2))/L;
Y_ = fft(YC12);
P2 = abs(Y_/L);
P1 = P2(1:L/2+1);
P1(2:end-1) = 2*P1(2:end-1);

%% Sine wave
Fc = 60;                     % hertz
x = -127*sqrt(2)*sin(2*pi*t*120-(48*pi/180));
%x = -127*sqrt(2)*sin(2*pi*Fc*t);

%% Corrente e Tensão RMS
random = rand(150,1);
for i=1:150
    IrmsC12(i) = (rms(YC12)*1.05-rms(YC12)*0.95)*random(i)+rms(YC12)*0.95;
    VrmsC12(i) = (rms(x)*1.05-rms(x)*0.95)*random(i)+rms(x)*0.95;
end

IrmsC12 = IrmsC12';
VrmsC12 = VrmsC12';

%% Potência ativa, total e aparente
SC12 = VrmsC12.*IrmsC12;
PC12 = ones(length(VrmsC12),1)*(PL1+PL3+PL4);
for i=1:150
    PC12(i)=((PL1+PL3+PL4)*1.05-(PL1+PL3+PL4)*0.95)*random(i)+(PL1+PL3+PL4)*0.95;
end
QC12 = abs(sqrt(SC12.^2-PC12.^2));

%% Fator de potência
FpC12 = PC12./SC12;
if any(isnan(FpC12))
   FpC12 = 0;
end
%% Amplitude das harmônicas
[pks,locs] = findpeaks(P1,f,'MinPeakHeight',max(P1)/2);
findpeaks(P1,f,'MinPeakDistance',locs(1)*1.75)
[amp_harC12, f_har] = findpeaks(P1,f,'MinPeakDistance',locs(1)*1.75);
amp_harC12 = amp_harC12(1:length(amp_harC12)-1)';

MC12 = [IrmsC12 PC12 SC12 QC12 FpC12 zeros(150,7)];
for i=1:150
    MC12(i,6)=(amp_harC12(1)*1.05-amp_harC12(1)*0.95)*random(i)+amp_harC12(1)*0.95;
    MC12(i,7)=(amp_harC12(2)*1.05-amp_harC12(2)*0.95)*random(i)+amp_harC12(2)*0.95;
    MC12(i,8)=(amp_harC12(3)*1.05-amp_harC12(3)*0.95)*random(i)+amp_harC12(3)*0.95;
    MC12(i,9)=(amp_harC12(4)*1.05-amp_harC12(4)*0.95)*random(i)+amp_harC12(4)*0.95;
    MC12(i,10)=(amp_harC12(5)*1.05-amp_harC12(5)*0.95)*random(i)+amp_harC12(5)*0.95;
    MC12(i,11)=(amp_harC12(6)*1.05-amp_harC12(6)*0.95)*random(i)+amp_harC12(6)*0.95;
    MC12(i,12)=(amp_harC12(7)*1.05-amp_harC12(7)*0.95)*random(i)+amp_harC12(7)*0.95;
end
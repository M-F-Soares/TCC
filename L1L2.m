%L1 L2
 IC13 = [0.03, 0.02;
0.05, 0.57;
0.76, 1.08;
0.40, 1.60;
0.15, 2.12;
-0.11, 2.64;
-0.07, 3.14;
-0.31, 3.66;
-0.24, 4.17;
-0.18, 4.69;
-0.14, 5.20;
-0.10, 5.72;
-0.08, 6.23;
-0.06, 6.75;
-0.05, 7.27;
-0.04, 7.79;
-0.03, 8.30;
-0.02, 8.82;
-0.98, 9.32;
-0.49, 9.84;
-0.08, 10.34;
0.10, 10.85;
0.14, 11.36;
0.27, 11.88;
0.25, 12.39;
0.19, 12.90;
0.15, 13.41;
0.11, 13.93;
0.09, 14.44;
0.06, 14.96;
0.05, 15.47;
0.03, 16.00;
0.03, 16.51;
0.02, 17.03;
0.86, 17.54;
0.59, 18.05;
0.14, 18.56;
0.11, 19.07;
-0.18, 19.58;
-0.17, 20.10;
-0.26, 20.61;
-0.20, 21.12;
-0.15, 21.63;
-0.12, 22.15;
-0.10, 22.66;
-0.07, 23.18;
-0.06, 23.69;
-0.04, 24.21;
-0.03, 24.72;
-0.02, 25.24;
-1.04, 25.75;
-0.84, 26.26;
-0.33, 26.77;
-0.06, 27.28;
-0.02, 27.78;
0.29, 28.30;
0.28, 28.80;
0.21, 29.31;
0.17, 29.82;
0.12, 30.34;
0.10, 30.86;
0.07, 31.37;
0.06, 31.89;
0.05, 32.42;
0.03, 32.92;
0.03, 33.45;
0.71, 33.96;
0.79, 34.47;
0.32, 34.98;
-0.04, 35.49;
-0.09, 36.00;
-0.19, 36.52;
-0.29, 37.03;
-0.23, 37.55;
-0.18, 38.06;
-0.14, 38.58;
-0.10, 39.09;
-0.08, 39.61;
-0.06, 40.12;
-0.05, 40.64;
-0.04, 41.15;
-0.03, 41.67;
-0.16, 42.17;
-0.55, 42.69;
-0.24, 43.19;
-0.02, 43.70;
0.05, 44.21;
0.02, 44.73;
0.31, 45.24;
0.24, 45.76;
0.18, 46.27;
0.14, 46.79;
0.10, 47.30;
0.08, 47.82;
0.06, 48.32;
0.05, 48.84;
0.04, 49.35;
0.03, 49.87;
0.02, 50.38;
1.00, 50.90;
0.49, 51.41;
-0.01, 51.92;
-0.07, 52.44;
-0.12, 52.96;
-0.32, 53.47;
-0.25, 53.99;
-0.19, 54.50;
-0.14, 55.02;
-0.11, 55.54;
-0.08, 56.05;
-0.06, 56.57;
-0.05, 57.09;
-0.04, 57.60;
-0.03, 58.12;
-0.03, 58.63;
-0.83, 59.15;
-0.45, 59.66;
-0.13, 60.17;
0.08, 60.68;
0.03, 61.18;
0.25, 61.70;
0.26, 62.21;
0.20, 62.72;
0.15, 63.24;
0.12, 63.76;
0.09, 64.28;
0.07, 64.79;
0.05, 65.33;
0.04, 65.86;
0.03, 66.40;
0.03, 66.94;
0.86, 67.49;
0.51, 68.02;
0.03, 68.56;
-0.10, 69.09;
-0.07, 69.64;
-0.31, 70.19;
-0.23, 70.73;
-0.18, 71.28;
-0.14, 71.81;
-0.11, 72.36;
-0.08, 72.90;
-0.06, 73.45;
-0.05, 73.98;
-0.04, 74.54;
-0.02, 75.08;
-0.92, 75.63;
-0.77, 76.16;
-0.21, 76.70;
-0.09, 77.24;
0.12, 77.78;
0.17, 78.32;
0.26, 78.86;
0.20, 79.40;
0.15, 79.94;
0.11, 80.48;
0.09, 81.02;
0.06, 81.56;
0.05, 82.10;
0.03, 82.65;
0.03, 83.19;
0.02, 83.74;
0.58, 84.29;
0.30, 84.83;
-0.07, 85.37;
-0.14, 85.91;
-0.15, 86.46;
-0.29, 87.00;
-0.22, 87.54;
-0.16, 88.08;
-0.12, 88.62;
-0.09, 89.16;
-0.07, 89.71;
-0.06, 90.25;
-0.04, 90.80;
-0.04, 91.35;
-0.02, 91.90;
-1.06, 92.44;
-0.53, 92.98;
-0.15, 93.52;
0.04, 94.06;
0.12, 94.60;
0.33, 95.14;
0.24, 95.68;
0.18, 96.22;
0.14, 96.76;
0.10, 97.30;
0.08, 97.85;
0.06, 98.39;
0.05, 98.94;
0.03, 99.48;
0.00, 100.00;];

%%
Fs = 2000;
StopTime = 100;              % miliseconds
t = linspace(0, StopTime, length(IC13(:,2)))';

IC13(1:end,2) = t;

%%
YC13 = IC13(1:end,1);
XC13 = IC13(1:end,2);
L = length(YC13);
RMS = ones(L,1).*rms(YC13);

f = Fs*(0:(L/2))/L;
Y_ = fft(YC13);
P2 = abs(Y_/L);
P1 = P2(1:L/2+1);
P1(2:end-1) = 2*P1(2:end-1);

%% Sine wave
Fc = 60;                     % hertz
x = -127*sqrt(2)*sin(2*pi*t*120-(48*pi/180));
%x = -127*sqrt(2)*sin(2*pi*Fc*t);

%% Corrente e Tensão RMS
random = rand(150,1);
for i=1:150
    IrmsC13(i) = (rms(YC13)*1.05-rms(YC13)*0.95)*random(i)+rms(YC13)*0.95;
    VrmsC13(i) = (rms(x)*1.05-rms(x)*0.95)*random(i)+rms(x)*0.95;
end

IrmsC13 = IrmsC13';
VrmsC13 = VrmsC13';

%% Potência ativa, total e aparente
SC13 = VrmsC13.*IrmsC13;
PC13 = ones(length(VrmsC13),1)*(PL1+PL2);
for i=1:150
    PC13(i)=((PL1+PL2)*1.05-(PL1+PL2)*0.95)*random(i)+(PL1+PL2)*0.95;
end
QC13 = abs(sqrt(SC13.^2-PC13.^2));

%% Fator de potência
FpC13 = PC13./SC13;
if any(isnan(FpC13))
   FpC13 = 0;
end
%% Amplitude das harmônicas
[pks,locs] = findpeaks(P1,f,'MinPeakHeight',max(P1)/2);
findpeaks(P1,f,'MinPeakDistance',locs(1)*1.75)
[amp_harC13, f_har] = findpeaks(P1,f,'MinPeakDistance',locs(1)*1.75);
amp_harC13 = amp_harC13(1:length(amp_harC13)-1)';

MC13 = [IrmsC13 PC13 SC13 QC13 FpC13 zeros(150,7)];
for i=1:150
    MC13(i,6)=(amp_harC13(1)*1.05-amp_harC13(1)*0.95)*random(i)+amp_harC13(1)*0.95;
    MC13(i,7)=(amp_harC13(2)*1.05-amp_harC13(2)*0.95)*random(i)+amp_harC13(2)*0.95;
    MC13(i,8)=(amp_harC13(3)*1.05-amp_harC13(3)*0.95)*random(i)+amp_harC13(3)*0.95;
    MC13(i,9)=(amp_harC13(4)*1.05-amp_harC13(4)*0.95)*random(i)+amp_harC13(4)*0.95;
    MC13(i,10)=(amp_harC13(5)*1.05-amp_harC13(5)*0.95)*random(i)+amp_harC13(5)*0.95;
    MC13(i,11)=(amp_harC13(6)*1.05-amp_harC13(6)*0.95)*random(i)+amp_harC13(6)*0.95;
    MC13(i,12)=(amp_harC13(7)*1.05-amp_harC13(7)*0.95)*random(i)+amp_harC13(7)*0.95;
end
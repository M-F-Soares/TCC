% %15W L2
 IC05 = [0.07, 0.02;
0.15, 0.57;
0.11, 1.08;
0.08, 1.61;
0.07, 2.12;
0.05, 2.64;
0.04, 3.14;
0.03, 3.66;
0.02, 4.17;
0.02, 4.69;
0.01, 5.20;
0.45, 5.72;
0.32, 6.22;
0.06, 6.74;
0.04, 7.24;
-0.02, 7.77;
-0.03, 8.28;
-0.16, 8.80;
-0.12, 9.30;
-0.09, 9.82;
-0.07, 10.33;
-0.06, 10.84;
-0.04, 11.35;
-0.03, 11.87;
-0.02, 12.38;
-0.02, 12.90;
-0.01, 13.42;
-0.46, 13.94;
-0.25, 14.44;
-0.15, 14.96;
0.04, 15.47;
0.07, 16.00;
0.05, 16.50;
0.16, 17.02;
0.12, 17.52;
0.09, 18.03;
0.07, 18.54;
0.06, 19.06;
0.04, 19.56;
0.03, 20.07;
0.02, 20.58;
0.02, 21.09;
0.01, 21.60;
0.01, 22.12;
0.45, 22.63;
0.09, 23.14;
0.13, 23.65;
0.00, 24.17;
-0.10, 24.68;
-0.20, 25.20;
-0.14, 25.71;
-0.10, 26.23;
-0.09, 26.74;
-0.06, 27.26;
-0.05, 27.78;
-0.04, 28.29;
-0.03, 28.80;
-0.02, 29.32;
-0.02, 29.83;
-0.01, 30.35;
-0.55, 30.86;
-0.31, 31.38;
0.06, 31.89;
0.00, 32.40;
0.11, 32.92;
0.05, 33.43;
0.14, 33.94;
0.10, 34.46;
0.08, 34.96;
0.06, 35.48;
0.04, 36.00;
0.04, 36.51;
0.03, 37.02;
0.02, 37.53;
0.01, 38.04;
0.01, 38.56;
0.53, 39.08;
0.29, 39.59;
0.04, 40.10;
0.03, 40.61;
-0.06, 41.12;
-0.05, 41.64;
-0.15, 42.15;
-0.11, 42.67;
-0.09, 43.18;
-0.06, 43.70;
-0.05, 44.22;
-0.04, 44.73;
-0.03, 45.24;
-0.03, 45.76;
-0.02, 46.27;
-0.01, 46.79;
-0.61, 47.31;
-0.39, 47.82;
-0.01, 48.33;
0.06, 48.85;
0.10, 49.36;
0.12, 49.88;
0.15, 50.39;
0.11, 50.90;
0.09, 51.41;
0.07, 51.93;
0.05, 52.44;
0.04, 52.95;
0.03, 53.46;
0.02, 53.98;
0.02, 54.50;
0.02, 55.01;
0.33, 55.53;
0.40, 56.04;
0.01, 56.54;
-0.04, 57.06;
-0.02, 57.57;
-0.17, 58.10;
-0.16, 58.61;
-0.13, 59.12;
-0.10, 59.64;
-0.07, 60.16;
-0.06, 60.67;
-0.04, 61.19;
-0.04, 61.70;
-0.03, 62.22;
-0.02, 62.74;
-0.02, 63.26;
-0.37, 63.77;
-0.29, 64.29;
-0.20, 64.81;
-0.01, 65.34;
0.07, 65.88;
0.13, 66.42;
0.16, 66.96;
0.12, 67.50;
0.09, 68.04;
0.06, 68.58;
0.05, 69.11;
0.04, 69.65;
0.03, 70.19;
0.02, 70.74;
0.01, 71.29;
0.01, 71.82;
0.60, 72.37;
0.28, 72.90;
0.13, 73.44;
-0.05, 73.98;
-0.08, 74.53;
-0.09, 75.06;
-0.13, 75.62;
-0.10, 76.16;
-0.07, 76.70;
-0.06, 77.25;
-0.04, 77.79;
-0.03, 78.34;
-0.03, 78.89;
-0.02, 79.44;
-0.02, 79.98;
-0.60, 80.54;
-0.25, 81.07;
-0.04, 81.62;
-0.07, 82.15;
0.06, 82.70;
0.09, 83.24;
0.14, 83.79;
0.11, 84.32;
0.07, 84.87;
0.06, 85.42;
0.05, 85.96;
0.03, 86.50;
0.03, 87.05;
0.02, 87.60;
0.01, 88.14;
0.19, 88.69;
0.40, 89.23;
0.20, 89.77;
0.06, 90.31;
0.01, 90.85;
-0.04, 91.40;
-0.15, 91.94;
-0.12, 92.48;
-0.09, 93.03;
-0.06, 93.58;
-0.05, 94.12;
-0.04, 94.67;
-0.03, 95.21;
-0.02, 95.75;
-0.02, 96.30;
-0.02, 96.85;
-0.57, 97.40;
-0.25, 97.94;
-0.04, 98.48;
0.05, 99.02;
0.00, 100.00;
0.00, 100.00;];

%%
Fs = 2000;
StopTime = 100;              % miliseconds
t = linspace(0, StopTime, length(IC05(:,2)))';

IC05(1:end,2) = t;

%%
YC05 = IC05(1:end,1);
XC05 = IC05(1:end,2);
L = length(YC05);
RMS = ones(L,1).*rms(YC05);

f = Fs*(0:(L/2))/L;
Y_ = fft(YC05);
P2 = abs(Y_/L);
P1 = P2(1:L/2+1);
P1(2:end-1) = 2*P1(2:end-1);

%% Sine wave
Fc = 60;                     % hertz
x = -127*sqrt(2)*sin(2*pi*t*120-(48*pi/180));
%x = -127*sqrt(2)*sin(2*pi*Fc*t);

%% Corrente e Tensão RMS
random = rand(150,1);
for i=1:150
    IrmsC05(i) = (rms(YC05)*1.05-rms(YC05)*0.95)*random(i)+rms(YC05)*0.95;
    VrmsC05(i) = (rms(x)*1.05-rms(x)*0.95)*random(i)+rms(x)*0.95;
end

IrmsC05 = IrmsC05';
VrmsC05 = VrmsC05';

%% Potência ativa, total e aparente
SC05 = VrmsC05.*IrmsC05;
PC05 = ones(length(VrmsC05),1)*PL2;
for i=1:150
    PC05(i)=(PL2*1.05-PL2*0.95)*random(i)+PL2*0.95;
end
QC05 = abs(sqrt(SC05.^2-PC05.^2));

%% Fator de potência
FpC05 = PC05./SC05;
if any(isnan(FpC05))
   FpC05 = 0;
end
%% Amplitude das harmônicas
[pks,locs] = findpeaks(P1,f,'MinPeakHeight',max(P1)/2);
findpeaks(P1,f,'MinPeakDistance',locs(1)*1.75)
[amp_harC05, f_har] = findpeaks(P1,f,'MinPeakDistance',locs(1)*1.75);
amp_harC05 = amp_harC05(1:length(amp_harC05)-1)';

MC05 = [IrmsC05 PC05 SC05 QC05 FpC05 zeros(150,7)];
for i=1:150
    MC05(i,6)=(amp_harC05(1)*1.05-amp_harC05(1)*0.95)*random(i)+amp_harC05(1)*0.95;
    MC05(i,7)=(amp_harC05(2)*1.05-amp_harC05(2)*0.95)*random(i)+amp_harC05(2)*0.95;
    MC05(i,8)=(amp_harC05(3)*1.05-amp_harC05(3)*0.95)*random(i)+amp_harC05(3)*0.95;
    MC05(i,9)=(amp_harC05(4)*1.05-amp_harC05(4)*0.95)*random(i)+amp_harC05(4)*0.95;
    MC05(i,10)=(amp_harC05(5)*1.05-amp_harC05(5)*0.95)*random(i)+amp_harC05(5)*0.95;
    MC05(i,11)=(amp_harC05(6)*1.05-amp_harC05(6)*0.95)*random(i)+amp_harC05(6)*0.95;
    MC05(i,12)=(amp_harC05(7)*1.05-amp_harC05(7)*0.95)*random(i)+amp_harC05(7)*0.95;
end
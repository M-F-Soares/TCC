% %20W L3
 IC03 = [-0.02, 0.02;
-0.01, 0.58;
-0.01, 1.09;
-0.26, 1.61;
-0.25, 2.12;
-0.06, 2.64;
0.07, 3.14;
0.05, 3.66;
0.15, 4.18;
0.11, 4.69;
0.09, 5.20;
0.07, 5.72;
0.05, 6.23;
0.03, 6.74;
0.03, 7.26;
0.02, 7.78;
0.01, 8.29;
0.01, 8.80;
0.01, 9.32;
0.50, 9.84;
0.36, 10.34;
-0.06, 10.86;
-0.03, 11.36;
-0.16, 11.89;
-0.10, 12.40;
-0.12, 12.92;
-0.09, 13.43;
-0.07, 13.95;
-0.05, 14.46;
-0.04, 14.98;
-0.03, 15.50;
-0.03, 16.02;
-0.02, 16.53;
-0.01, 17.04;
-0.01, 17.56;
-0.57, 18.08;
-0.34, 18.58;
-0.08, 19.10;
0.08, 19.60;
0.00, 20.12;
0.12, 20.63;
0.12, 21.14;
0.09, 21.65;
0.07, 22.17;
0.05, 22.68;
0.04, 23.20;
0.03, 23.72;
0.02, 24.23;
0.02, 24.74;
0.01, 25.26;
0.01, 25.78;
0.47, 26.29;
0.20, 26.80;
0.14, 27.31;
-0.06, 27.82;
-0.06, 28.34;
-0.10, 28.85;
-0.13, 29.36;
-0.10, 29.88;
-0.08, 30.40;
-0.05, 30.91;
-0.05, 31.43;
-0.03, 31.95;
-0.03, 32.47;
-0.02, 32.98;
-0.02, 33.49;
-0.01, 34.00;
-0.34, 34.52;
-0.38, 35.02;
-0.08, 35.53;
0.00, 36.04;
0.02, 36.56;
0.04, 37.07;
0.13, 37.59;
0.11, 38.10;
0.08, 38.62;
0.06, 39.13;
0.04, 39.65;
0.04, 40.17;
0.03, 40.68;
0.02, 41.19;
0.01, 41.71;
0.01, 42.22;
0.01, 42.74;
0.35, 43.26;
0.12, 43.77;
-0.01, 44.28;
-0.07, 44.80;
-0.10, 45.31;
-0.14, 45.83;
-0.11, 46.34;
-0.08, 46.86;
-0.06, 47.37;
-0.05, 47.89;
-0.04, 48.40;
-0.03, 48.92;
-0.02, 49.43;
-0.02, 49.95;
-0.01, 50.46;
-0.01, 50.98;
-0.32, 51.50;
-0.13, 52.00;
0.04, 52.52;
0.04, 53.03;
0.10, 53.54;
0.15, 54.06;
0.11, 54.57;
0.08, 55.09;
0.06, 55.61;
0.05, 56.12;
0.04, 56.63;
0.03, 57.15;
0.02, 57.67;
0.01, 58.18;
0.01, 58.68;
0.01, 59.21;
0.43, 59.72;
0.28, 60.24;
0.11, 60.74;
-0.12, 61.26;
-0.07, 61.78;
-0.13, 62.30;
-0.11, 62.82;
-0.09, 63.34;
-0.07, 63.85;
-0.05, 64.38;
-0.04, 64.89;
-0.03, 65.44;
-0.02, 65.97;
-0.01, 66.51;
-0.01, 67.05;
-0.01, 67.59;
-0.34, 68.14;
-0.11, 68.68;
0.01, 69.22;
-0.01, 69.76;
0.12, 70.31;
0.13, 70.85;
0.10, 71.39;
0.08, 71.93;
0.06, 72.47;
0.04, 73.01;
0.03, 73.55;
0.03, 74.10;
0.02, 74.64;
0.01, 75.18;
0.01, 75.72;
0.45, 76.26;
0.36, 76.81;
0.09, 77.35;
-0.10, 77.89;
-0.08, 78.44;
-0.15, 78.99;
-0.11, 79.54;
-0.08, 80.08;
-0.06, 80.63;
-0.04, 81.17;
-0.03, 81.72;
-0.03, 82.26;
-0.02, 82.80;
-0.02, 83.35;
-0.01, 83.89;
-0.48, 84.44;
-0.44, 84.98;
-0.13, 85.51;
-0.01, 86.06;
-0.00, 86.61;
0.11, 87.16;
0.13, 87.70;
0.09, 88.24;
0.07, 88.78;
0.05, 89.32;
0.04, 89.86;
0.03, 90.40;
0.02, 90.95;
0.02, 91.50;
0.01, 92.05;
0.00, 92.59;
0.36, 93.14;
0.13, 93.68;
-0.01, 94.22;
-0.08, 94.78;
-0.01, 95.32;
-0.13, 95.87;
-0.09, 96.42;
-0.07, 96.96;
-0.05, 97.50;
-0.04, 98.05;
-0.03, 98.58;
-0.03, 99.14;
0.00, 100.00;];

%%
Fs = 2000;
StopTime = 100;              % miliseconds
t = linspace(0, StopTime, length(IC03(:,2)))';

IC03(1:end,2) = t;

%%
YC03 = IC03(1:end,1);
XC03 = IC03(1:end,2);
L = length(YC03);
RMS = ones(L,1).*rms(YC03);

f = Fs*(0:(L/2))/L;
Y_ = fft(YC03);
P2 = abs(Y_/L);
P1 = P2(1:L/2+1);
P1(2:end-1) = 2*P1(2:end-1);

%% Sine wave
Fc = 60;                     % hertz
x = -127*sqrt(2)*sin(2*pi*t*120-(48*pi/180));
%x = -127*sqrt(2)*sin(2*pi*Fc*t);

%% Corrente e Tensão RMS
random = rand(150,1);
for i=1:150
    IrmsC03(i) = (rms(YC03)*1.05-rms(YC03)*0.95)*random(i)+rms(YC03)*0.95;
    VrmsC03(i) = (rms(x)*1.05-rms(x)*0.95)*random(i)+rms(x)*0.95;
end

IrmsC03 = IrmsC03';
VrmsC03 = VrmsC03';

%% Potência ativa, total e aparente
SC03 = VrmsC03.*IrmsC03;
PC03 = ones(length(VrmsC03),1)*PL3;
for i=1:150
    PC03(i)=(PL3*1.05-PL3*0.95)*random(i)+PL3*0.95;
end
QC03 = abs(sqrt(SC03.^2-PC03.^2));

%% Fator de potência
FpC03 = PC03./SC03;
if any(isnan(FpC03))
   FpC03 = 0;
end
%% Amplitude das harmônicas
[pks,locs] = findpeaks(P1,f,'MinPeakHeight',max(P1)/2);
findpeaks(P1,f,'MinPeakDistance',locs(1)*1.75)
[amp_harC03, f_har] = findpeaks(P1,f,'MinPeakDistance',locs(1)*1.75);
amp_harC03 = amp_harC03(1:length(amp_harC03)-1)';

MC03 = [IrmsC03 PC03 SC03 QC03 FpC03 zeros(150,7)];
for i=1:150
    MC03(i,6)=(amp_harC03(1)*1.05-amp_harC03(1)*0.95)*random(i)+amp_harC03(1)*0.95;
    MC03(i,7)=(amp_harC03(2)*1.05-amp_harC03(2)*0.95)*random(i)+amp_harC03(2)*0.95;
    MC03(i,8)=(amp_harC03(3)*1.05-amp_harC03(3)*0.95)*random(i)+amp_harC03(3)*0.95;
    MC03(i,9)=(amp_harC03(4)*1.05-amp_harC03(4)*0.95)*random(i)+amp_harC03(4)*0.95;
    MC03(i,10)=(amp_harC03(5)*1.05-amp_harC03(5)*0.95)*random(i)+amp_harC03(5)*0.95;
    MC03(i,11)=(amp_harC03(6)*1.05-amp_harC03(6)*0.95)*random(i)+amp_harC03(6)*0.95;
    MC03(i,12)=(amp_harC03(7)*1.05-amp_harC03(7)*0.95)*random(i)+amp_harC03(7)*0.95;
end
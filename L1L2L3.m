%L1 L2 L3
 IC15 = [1.02, 0.02;
0.90, 0.57;
0.31, 1.07;
0.20, 1.59;
-0.03, 2.09;
-0.13, 2.62;
-0.47, 3.13;
-0.37, 3.64;
-0.28, 4.16;
-0.23, 4.68;
-0.17, 5.18;
-0.13, 5.70;
-0.10, 6.22;
-0.08, 6.73;
-0.06, 7.25;
-0.04, 7.78;
-0.21, 8.29;
-1.23, 8.81;
-0.80, 9.32;
-0.01, 9.83;
0.15, 10.34;
0.03, 10.86;
0.52, 11.37;
0.38, 11.88;
0.30, 12.39;
0.23, 12.90;
0.18, 13.41;
0.13, 13.93;
0.10, 14.44;
0.08, 14.96;
0.06, 15.47;
0.05, 15.99;
0.04, 16.50;
1.40, 17.01;
0.73, 17.51;
0.18, 18.02;
0.07, 18.53;
-0.15, 19.05;
-0.33, 19.56;
-0.41, 20.07;
-0.31, 20.58;
-0.25, 21.10;
-0.19, 21.60;
-0.15, 22.12;
-0.11, 22.63;
-0.08, 23.15;
-0.07, 23.66;
-0.05, 24.18;
-0.03, 24.68;
-1.68, 25.20;
-0.91, 25.70;
-0.40, 26.21;
-0.08, 26.72;
0.31, 27.24;
0.38, 27.74;
0.43, 28.26;
0.33, 28.76;
0.26, 29.27;
0.21, 29.78;
0.16, 30.30;
0.12, 30.80;
0.10, 31.32;
0.07, 31.84;
0.05, 32.36;
0.04, 32.87;
1.46, 33.39;
0.96, 33.89;
0.25, 34.40;
-0.12, 34.90;
-0.25, 35.42;
-0.21, 35.93;
-0.46, 36.44;
-0.36, 36.95;
-0.27, 37.46;
-0.22, 37.97;
-0.16, 38.49;
-0.13, 39.00;
-0.10, 39.52;
-0.08, 40.04;
-0.06, 40.56;
-0.05, 41.07;
-0.48, 41.59;
-1.20, 42.10;
-0.46, 42.61;
-0.04, 43.12;
-0.06, 43.64;
0.34, 44.15;
0.48, 44.66;
0.37, 45.18;
0.29, 45.69;
0.23, 46.20;
0.18, 46.71;
0.13, 47.22;
0.10, 47.74;
0.08, 48.24;
0.06, 48.75;
0.05, 49.26;
0.03, 49.78;
1.35, 50.28;
0.75, 50.79;
0.12, 51.30;
0.10, 51.81;
-0.21, 52.32;
-0.31, 52.84;
-0.40, 53.35;
-0.31, 53.86;
-0.24, 54.37;
-0.19, 54.89;
-0.15, 55.41;
-0.11, 55.92;
-0.08, 56.44;
-0.07, 56.96;
-0.05, 57.47;
-0.04, 57.99;
-1.42, 58.50;
-1.07, 59.02;
-0.32, 59.52;
-0.09, 60.03;
0.26, 60.54;
0.25, 61.06;
0.43, 61.56;
0.33, 62.07;
0.26, 62.58;
0.19, 63.10;
0.15, 63.62;
0.12, 64.13;
0.09, 64.64;
0.06, 65.18;
0.05, 65.72;
0.04, 66.26;
1.63, 66.80;
1.06, 67.34;
0.27, 67.87;
-0.19, 68.41;
-0.35, 68.95;
-0.45, 69.50;
-0.39, 70.04;
-0.30, 70.58;
-0.22, 71.11;
-0.17, 71.66;
-0.13, 72.20;
-0.10, 72.74;
-0.08, 73.29;
-0.06, 73.83;
-0.05, 74.38;
-1.17, 74.93;
-1.18, 75.47;
-0.28, 76.01;
0.14, 76.55;
0.05, 77.09;
0.35, 77.63;
0.43, 78.16;
0.33, 78.71;
0.24, 79.24;
0.19, 79.78;
0.15, 80.32;
0.11, 80.85;
0.08, 81.39;
0.06, 81.94;
0.05, 82.48;
0.03, 83.02;
1.47, 83.58;
0.61, 84.10;
0.09, 84.65;
-0.03, 85.18;
-0.31, 85.73;
-0.47, 86.27;
-0.37, 86.82;
-0.28, 87.36;
-0.21, 87.91;
-0.15, 88.45;
-0.12, 89.00;
-0.09, 89.54;
-0.07, 90.08;
-0.06, 90.62;
-0.04, 91.17;
-1.82, 91.72;
-0.75, 92.26;
-0.25, 92.80;
0.25, 93.34;
0.30, 93.88;
0.46, 94.42;
0.39, 94.96;
0.30, 95.50;
0.24, 96.04;
0.17, 96.58;
0.13, 97.12;
0.10, 97.66;
0.08, 98.20;
0.05, 98.74;
0.04, 99.28;
0.00, 100.00;];

%%
Fs = 2000;
StopTime = 100;              % miliseconds
t = linspace(0, StopTime, length(IC15(:,2)))';

IC15(1:end,2) = t;

%%
YC15 = IC15(1:end,1);
XC15 = IC15(1:end,2);
L = length(YC15);
RMS = ones(L,1).*rms(YC15);

f = Fs*(0:(L/2))/L;
Y_ = fft(YC15);
P2 = abs(Y_/L);
P1 = P2(1:L/2+1);
P1(2:end-1) = 2*P1(2:end-1);

%% Sine wave
Fc = 60;                     % hertz
x = -127*sqrt(2)*sin(2*pi*t*120-(48*pi/180));
%x = -127*sqrt(2)*sin(2*pi*Fc*t);

%% Corrente e Tensão RMS
random = rand(150,1);
for i=1:150
    IrmsC15(i) = (rms(YC15)*1.05-rms(YC15)*0.95)*random(i)+rms(YC15)*0.95;
    VrmsC15(i) = (rms(x)*1.05-rms(x)*0.95)*random(i)+rms(x)*0.95;
end

IrmsC15 = IrmsC15';
VrmsC15 = VrmsC15';

%% Potência ativa, total e aparente
SC15 = VrmsC15.*IrmsC15;
PC15 = ones(length(VrmsC15),1)*(PL1+PL2+PL3);
for i=1:150
    PC15(i)=((PL1+PL2+PL3)*1.05-(PL1+PL2+PL3)*0.95)*random(i)+(PL1+PL2+PL3)*0.95;
end
QC15 = abs(sqrt(SC15.^2-PC15.^2));

%% Fator de potência
FpC15 = PC15./SC15;
if any(isnan(FpC15))
   FpC15 = 0;
end
%% Amplitude das harmônicas
[pks,locs] = findpeaks(P1,f,'MinPeakHeight',max(P1)/2);
findpeaks(P1,f,'MinPeakDistance',locs(1)*1.75)
[amp_harC15, f_har] = findpeaks(P1,f,'MinPeakDistance',locs(1)*1.75);
amp_harC15 = amp_harC15(1:length(amp_harC15)-1)';

MC15 = [IrmsC15 PC15 SC15 QC15 FpC15 zeros(150,7)];
for i=1:150
    MC15(i,6)=(amp_harC15(1)*1.05-amp_harC15(1)*0.95)*random(i)+amp_harC15(1)*0.95;
    MC15(i,7)=(amp_harC15(2)*1.05-amp_harC15(2)*0.95)*random(i)+amp_harC15(2)*0.95;
    MC15(i,8)=(amp_harC15(3)*1.05-amp_harC15(3)*0.95)*random(i)+amp_harC15(3)*0.95;
    MC15(i,9)=(amp_harC15(4)*1.05-amp_harC15(4)*0.95)*random(i)+amp_harC15(4)*0.95;
    MC15(i,10)=(amp_harC15(5)*1.05-amp_harC15(5)*0.95)*random(i)+amp_harC15(5)*0.95;
    MC15(i,11)=(amp_harC15(6)*1.05-amp_harC15(6)*0.95)*random(i)+amp_harC15(6)*0.95;
    MC15(i,12)=(amp_harC15(7)*1.05-amp_harC15(7)*0.95)*random(i)+amp_harC15(7)*0.95;
end